{% extends "index.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/stock.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/bootstrap-multiselect-min.css') }}">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/bootstrap-multiselect.min.js') }}"></script>
<script src="{{ url_for('static', filename='scripts/plotly.js') }}"></script>
{% endblock %}

{% block content %}
<h2>Explore</h2>


<div class="d-flex bd-highlight">

  <div class="p-4 bd-highlight fixed-width-1">
    <div class="row">
      <select id="example-getting-started" multiple="multiple">
        {% for item in tickers_info %}
        <option class="ticker-option" value="{{ item.ticker }}">{{item.ticker}} ({{item.company_name}})</option>
        {% endfor %}>
      </select>
    </div>
    <div class="row">
      <span class="badge bg-light text-dark">Selected assets: </span>
      <span class="badge bg-secondary">Stock1</span>
      <span class="badge bg-secondary">Stock2</span>
      <span class="badge bg-secondary">Stock2</span>
      <span class="badge bg-secondary">Stock2</span>
      <span class="badge bg-secondary">Stock2</span>
      <span class="badge bg-secondary">Stock2</span>
    </div>
    <div class="row">
      <div class="col-sm-offset-2 col-sm-10">
        <button onclick="select()" class="btn btn-default">Submit</button>
      </div>
    </div>

  </div>
  <div class="p-2 bd-highlight container-fluid">
    <div id="chart" class="chart"></div>
  </div>
</div>

<div class="d-flex bd-highlight row">
  Tables here
</div>



{% endblock %}


{% block endscripts %}
<script type="text/javascript">
  /*var table = {{ dailyreturntableJSON | safe}};
  Plotly.plot('table', table, {});*/

  function fillSelectBox(graphJSON) {
    $('#example-getting-started').multiselect('select',
      graphJSON.data.map(function (value) {
        console.log(value.legendgroup)
        return value.legendgroup;
      })
    );
  }

  $(document).ready(function () {
    $('#example-getting-started').multiselect({
      enableFiltering: true,
      includeFilterClearBtn: false,
      enableCaseInsensitiveFiltering: true,
      buttonWidth: '100%',
      numberDisplayed: 1
    });

    var graphJSON = {{ linegraphJSON | safe}};
    Plotly.plot('chart', graphJSON, {});
    fillSelectBox(graphJSON);
  });


  function select() {
    var selected_tickers = $('#example-getting-started option:selected').map(function () {
      return this.value;
    }).get();
    $.getJSON({
      url: "/stock/select",
      data: { 'data': selected_tickers },
      success: function (result) {
        console.log(result.data);
        //fillSelectBox(result);
        // Retrieve tickers supplied to plot and add them to select box

        Plotly.newPlot('chart', result, {});
      }
    });
  }
</script>
{% endblock %}